---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Dinos!">
  <section>
    <h1>List of Dinosaurs</h1>
    <div id="dinoList"></div> 
  </section>

  <script is:inline>
    async function fetchDinos() {
      const dinoList = document.getElementById('dinoList');
      dinoList.innerHTML = '<p>Loading dinosaurs...</p>'; // Loading indicator

      try {
        const res = await fetch("https://norian.studio/wp-json/wp/v2/dinos?&_embed");

        if (!res.ok) {
          throw new Error(`Failed to fetch: ${res.status}`);
        }

        const posts = await res.json();

        dinoList.innerHTML = ""; // Clear loading indicator

        posts.forEach(post => {
          const article = document.createElement('article');
          article.innerHTML = `
            <img src="${post._embedded['wp:featuredmedia']['0'].media_details.sizes.medium.source_url}" />
            <h2><a href="/dinos/${post.slug}/">${post.title.rendered}</a></h2>
            ${post.content.rendered}
          `;
          dinoList.appendChild(article);
        });
      } catch (error) {
        console.error("Error fetching dinosaurs:", error);
        dinoList.innerHTML = '<p>Sorry, an error occurred while loading the dinosaurs.</p>';
      }
    }

    fetchDinos(); // Call the function on page load
  </script>
</Layout>
